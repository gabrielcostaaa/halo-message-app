### üîê Halo API - Testes de Autentica√ß√£o JWT
### Base URL
@baseUrl = http://localhost:3000
@token = seu_token_aqui

###############################################
# 1Ô∏è‚É£ REGISTRO DE NOVO USU√ÅRIO
###############################################

### Registrar novo usu√°rio
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Jo√£o Silva",
  "username": "joao",
  "password": "senha123",
  "avatar": "https://i.pravatar.cc/150?u=joao"
}

### Registrar usu√°rio sem avatar (opcional)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Maria Santos",
  "username": "maria",
  "password": "senha456"
}

### Teste: Username duplicado (deve retornar erro 409)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Alice Teste",
  "username": "alice",
  "password": "123456"
}

### Teste: Senha muito curta (deve retornar erro 400)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Teste Falha",
  "username": "teste",
  "password": "123"
}

###############################################
# 2Ô∏è‚É£ LOGIN
###############################################

### Login com alice (usu√°rio do seed)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "alice",
  "password": "123456"
}

### Login com bruno (usu√°rio do seed)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "bruno",
  "password": "123456"
}

### Login com usu√°rio rec√©m criado
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "joao",
  "password": "senha123"
}

### Teste: Senha incorreta (deve retornar erro 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "alice",
  "password": "senha_errada"
}

### Teste: Usu√°rio inexistente (deve retornar erro 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "usuario_inexistente",
  "password": "123456"
}

###############################################
# 3Ô∏è‚É£ ROTAS PROTEGIDAS (Requer Token JWT)
###############################################

### Listar todos os usu√°rios (PROTEGIDO)
GET {{baseUrl}}/users
Authorization: Bearer {{token}}

### Obter dados do usu√°rio autenticado (PROTEGIDO)
GET {{baseUrl}}/users/me
Authorization: Bearer {{token}}

### Buscar usu√°rio por ID (PROTEGIDO)
GET {{baseUrl}}/users/674158b2a0e1e72e50c15c5e
Authorization: Bearer {{token}}

### Teste: Acesso sem token (deve retornar erro 401)
GET {{baseUrl}}/users

### Teste: Acesso com token inv√°lido (deve retornar erro 401)
GET {{baseUrl}}/users
Authorization: Bearer token_invalido_aqui

###############################################
# 4Ô∏è‚É£ FLUXO COMPLETO DE TESTE
###############################################

### Passo 1: Registrar um novo usu√°rio
# @name register
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Teste Completo",
  "username": "teste_{{$randomInt}}",
  "password": "senha123",
  "avatar": "https://i.pravatar.cc/150?u={{$randomInt}}"
}

###

### Passo 2: Extrair o token e salvar
@newToken = {{register.response.body.access_token}}

### Passo 3: Usar o token para acessar rota protegida
GET {{baseUrl}}/users/me
Authorization: Bearer {{newToken}}

###############################################
# 5Ô∏è‚É£ TESTES DE VALIDA√á√ÉO ZOD
###############################################

### Teste: Email inv√°lido no username
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Teste",
  "username": "us",
  "password": "123456"
}

### Teste: Campos obrigat√≥rios faltando
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Teste"
}

### Teste: Avatar com URL inv√°lida
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "name": "Teste Avatar",
  "username": "teste_avatar",
  "password": "senha123",
  "avatar": "not-a-valid-url"
}

###############################################
# 6Ô∏è‚É£ HEALTHCHECK
###############################################

### Verificar se a API est√° online
GET {{baseUrl}}

###############################################
# üìù INSTRU√á√ïES DE USO
###############################################

# 1. Instale a extens√£o "REST Client" no VS Code
# 2. Certifique-se de que a API est√° rodando (yarn dev)
# 3. Execute o seed: yarn seed
# 4. Clique em "Send Request" acima de cada requisi√ß√£o
# 5. Para usar o token, copie da resposta e cole na vari√°vel @token no topo
# 6. Ou use o fluxo completo (se√ß√£o 4) que extrai o token automaticamente

###############################################
# üîë CREDENCIAIS DO SEED
###############################################

# Username: alice | Senha: 123456
# Username: bruno | Senha: 123456
# Username: carlos | Senha: 123456
# Username: diana | Senha: 123456
# Username: eduardo | Senha: 123456

###############################################
# üìä ESTRUTURA DO TOKEN JWT
###############################################

# Payload:
# {
#   "sub": "507f1f77bcf86cd799439011",  // ID do usu√°rio
#   "username": "alice",                 // Username
#   "iat": 1700000000,                   // Issued at
#   "exp": 1700604800                    // Expiration (7 dias)
# }
